<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disk Marmitas - Pedidos Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Permanent+Marker&display=swap');

        :root {
            --brand-cyan: #00d4ff; 
            --brand-dark: #1a1a1a;
            --brand-gray: #2d2d2d;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--brand-dark);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23333333' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            color: #fff;
            padding-bottom: 100px; /* Space for bottom cart bar */
        }

        .title-font { font-family: 'Permanent Marker', cursive; }
        
        .glass-panel {
            background: rgba(45, 45, 45, 0.95);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .price-tag {
            background: var(--brand-cyan);
            color: #000;
            font-weight: 800;
            clip-path: polygon(10% 0, 100% 0, 100% 100%, 0% 100%);
        }

        .meat-option.selected {
            background-color: rgba(0, 212, 255, 0.2);
            border-color: var(--brand-cyan);
            color: var(--brand-cyan);
            border: 1px solid var(--brand-cyan);
        }
        
        /* Input Styles */
        .input-dark {
            background-color: #2d2d2d;
            border: 1px solid #4b5563;
            color: white;
            padding: 8px;
            border-radius: 6px;
            width: 100%;
        }
        .input-dark:focus { border-color: var(--brand-cyan); outline: none; }
        .input-dark:disabled { opacity: 0.5; cursor: not-allowed; }

        .hidden { display: none !important; }
        
        /* Custom Scrollbar for Modal */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--brand-cyan); }

        /* Animation for AI Sparkles */
        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }
        .animate-sparkle {
            animation: sparkle 2s infinite;
        }
    </style>
</head>
<body>

    <!-- ========================================== -->
    <!-- √ÅREA DO CLIENTE (VISUALIZA√á√ÉO NORMAL) -->
    <!-- ========================================== -->

    <!-- Header -->
    <header class="bg-gradient-to-b from-gray-900 to-transparent sticky top-0 z-40 pt-4 pb-6 px-4">
        <div class="max-w-5xl mx-auto flex justify-between items-center bg-gray-900/90 backdrop-blur-md p-4 rounded-2xl border border-gray-700 shadow-xl">
            <div class="flex items-center gap-4">
                <!-- Logo Container -->
                <img id="headerLogo" src="" alt="Logo" class="w-12 h-12 sm:w-16 sm:h-16 rounded-full object-cover border-2 border-cyan-400 hidden shadow-[0_0_15px_rgba(0,212,255,0.3)]">
                
                <div>
                    <h1 id="headerTitle" class="text-2xl sm:text-3xl md:text-4xl title-font text-cyan-400 drop-shadow-lg leading-none">DISK MARMITAS</h1>
                    <p class="text-gray-400 text-[10px] sm:text-xs font-medium tracking-wide mt-1">COMIDA CASEIRA DE VERDADE</p>
                </div>
            </div>
            
            <div class="text-right">
                <div id="statusBadge" class="inline-block px-2 py-1 rounded bg-green-500/20 text-green-400 text-[10px] font-bold border border-green-500/30 mb-1">
                    ABERTO
                </div>
                <div class="text-cyan-400 font-bold flex items-center justify-end gap-1 text-sm">
                    <i class="fas fa-motorcycle"></i> <span id="headerDeliveryFee">R$ 3,00</span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 space-y-8" id="menuContainer">
        <!-- O Card√°pio ser√° gerado aqui via JavaScript -->
        <div class="text-center py-20">
            <i class="fas fa-circle-notch fa-spin text-4xl text-cyan-400"></i>
            <p class="mt-4 text-gray-400">Carregando card√°pio...</p>
        </div>
    </main>

    <!-- Footer -->
    <div class="text-center pt-12 pb-24 text-gray-600 text-xs">
        <p>Desenvolvido para Disk Marmitas</p>
        <button onclick="openAdminLogin()" class="mt-4 opacity-30 hover:opacity-100 transition-opacity">
            <i class="fas fa-lock"></i> √Årea do Dono
        </button>
    </div>

    <!-- ========================================== -->
    <!-- INTERFACES FLUTUANTES -->
    <!-- ========================================== -->

    <!-- Modal AI Chef -->
    <div id="aiModal" class="fixed inset-0 z-[80] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 w-full max-w-md rounded-2xl border border-cyan-500/50 shadow-[0_0_30px_rgba(0,212,255,0.2)] p-6 text-center relative overflow-hidden">
            <!-- Background Decoration -->
            <div class="absolute top-[-50px] right-[-50px] w-32 h-32 bg-cyan-500/10 rounded-full blur-3xl"></div>
            
            <button onclick="closeModal('aiModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
            
            <div class="mb-4">
                <div class="inline-block p-3 rounded-full bg-cyan-500/20 mb-2">
                    <i class="fas fa-robot text-3xl text-cyan-400"></i>
                </div>
                <h3 class="text-xl font-bold text-white title-font" id="aiModalTitle">Chef IA Sugere</h3>
            </div>
            
            <div id="aiContent" class="min-h-[100px] flex items-center justify-center flex-col">
                <!-- Conte√∫do injetado via JS -->
            </div>

            <button onclick="askChefAI()" class="mt-6 w-full py-2 rounded-lg border border-cyan-500/30 text-cyan-400 text-sm hover:bg-cyan-500/10 transition-colors">
                <i class="fas fa-redo-alt mr-2"></i> Tentar outra sugest√£o
            </button>
        </div>
    </div>

    <!-- Barra de Carrinho -->
    <div id="cartBar" class="fixed bottom-0 left-0 right-0 z-50 p-4 pb-6 bg-[#0f172a] border-t border-gray-700 transform translate-y-full transition-transform duration-300 shadow-2xl">
        <div class="max-w-5xl mx-auto flex justify-between items-center gap-4">
            <div class="flex-1 cursor-pointer" onclick="openCartModal()">
                <p class="text-gray-400 text-xs uppercase tracking-wider mb-1 flex items-center gap-1">
                    Total <i class="fas fa-chevron-up text-[10px]"></i>
                </p>
                <div class="flex items-baseline gap-2">
                    <span id="cartTotal" class="text-2xl font-bold text-white">R$ 0,00</span>
                    <span id="cartCount" class="text-sm text-cyan-400">(0)</span>
                </div>
            </div>
            <button onclick="openCartModal()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg flex items-center gap-2">
                Ver Pedido
            </button>
        </div>
    </div>

    <!-- Modal Carrinho / Checkout -->
    <div id="cartModal" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm hidden flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="bg-[#1a1a1a] w-full max-w-lg rounded-t-2xl sm:rounded-2xl border border-gray-700 shadow-2xl max-h-[95vh] flex flex-col">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50 rounded-t-2xl">
                <h3 class="text-xl font-bold text-white">Finalizar Pedido</h3>
                <button onclick="closeModal('cartModal')" class="text-gray-400 hover:text-white p-2"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="p-4 overflow-y-auto flex-1 space-y-4">
                <div id="cartItemsList" class="space-y-2"></div>
                
                <div class="pt-4 border-t border-gray-700">
                    <!-- Op√ß√£o de Entrega -->
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <label class="cursor-pointer">
                            <input type="radio" name="deliveryType" value="entrega" checked class="hidden" onchange="toggleDelivery(true)">
                            <div id="delOption1" class="bg-gray-800 border border-cyan-500 rounded-lg p-3 text-center transition-colors">
                                <i class="fas fa-motorcycle text-cyan-400"></i> <span class="text-sm font-bold block">Entrega</span>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="deliveryType" value="retirada" class="hidden" onchange="toggleDelivery(false)">
                            <div id="delOption2" class="bg-gray-800 border border-gray-600 rounded-lg p-3 text-center transition-colors">
                                <i class="fas fa-store text-gray-400"></i> <span class="text-sm font-bold block">Retirada</span>
                            </div>
                        </label>
                    </div>

                    <div class="space-y-2">
                        <input type="text" id="clientName" placeholder="Seu Nome" class="input-dark">
                        <input type="text" id="clientAddress" placeholder="Endere√ßo Completo" class="input-dark">
                        <select id="paymentMethod" class="input-dark">
                            <option value="">Forma de Pagamento...</option>
                            <option value="Pix">Pix</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Cart√£o">Cart√£o</option>
                        </select>
                        <input type="text" id="orderObs" placeholder="Observa√ß√µes (Opcional)..." class="input-dark">
                    </div>
                </div>
            </div>

            <div class="p-4 bg-gray-900/50 border-t border-gray-700 rounded-b-2xl">
                <div class="flex justify-between text-sm mb-2 text-gray-400">
                    <span>Taxa</span> <span id="checkoutFee">R$ 0,00</span>
                </div>
                <div class="flex justify-between text-xl font-bold text-white mb-4">
                    <span>Total</span> <span id="checkoutTotal" class="text-cyan-400">R$ 0,00</span>
                </div>
                <button onclick="finalizeOrder()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl shadow-lg transition-colors">
                    <i class="fab fa-whatsapp"></i> Enviar Pedido
                </button>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- √ÅREA ADMINISTRATIVA (PAINEL DO DONO) -->
    <!-- ========================================== -->

    <!-- Modal Login Admin -->
    <div id="adminLoginModal" class="fixed inset-0 z-[70] bg-black/90 hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-600 w-full max-w-sm text-center">
            <h3 class="text-xl font-bold mb-4">Acesso do Dono üîí</h3>
            <input type="password" id="adminPass" placeholder="Senha" class="input-dark mb-4 text-center">
            <div class="flex gap-2">
                <button onclick="closeModal('adminLoginModal')" class="flex-1 py-2 rounded bg-gray-700 hover:bg-gray-600">Cancelar</button>
                <button onclick="checkAdminLogin()" class="flex-1 py-2 rounded bg-cyan-600 hover:bg-cyan-500 font-bold">Entrar</button>
            </div>
        </div>
    </div>

    <!-- Painel de Controle (Dashboard) -->
    <div id="adminPanel" class="fixed inset-0 z-[65] bg-gray-900 overflow-y-auto hidden">
        <div class="max-w-4xl mx-auto p-4 pb-20">
            <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
                <h2 class="text-2xl font-bold text-cyan-400">Painel de Controle</h2>
                <button onclick="closeAdminPanel()" class="text-gray-400 hover:text-white">Sair <i class="fas fa-sign-out-alt"></i></button>
            </div>

            <!-- Configura√ß√µes Gerais -->
            <div class="glass-panel p-4 rounded-xl mb-6">
                <h3 class="font-bold text-lg mb-4 text-yellow-400">‚öôÔ∏è Configura√ß√µes da Loja</h3>
                
                <!-- Status Manual -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="text-xs text-gray-400">Status da Loja (Manual)</label>
                        <select id="admIsOpen" class="input-dark font-bold" onchange="saveSettings()">
                            <option value="true">üü¢ Aberta</option>
                            <option value="false">üî¥ Fechada</option>
                        </select>
                        <p id="manualStatusHint" class="text-[10px] text-yellow-500 hidden mt-1">‚ö†Ô∏è Controlado pelo hor√°rio autom√°tico</p>
                    </div>
                </div>

                <!-- Configura√ß√£o de Hor√°rio Autom√°tico -->
                <div class="border border-gray-700 bg-gray-800/50 rounded-lg p-3 mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <label class="flex items-center gap-2 cursor-pointer select-none">
                            <input type="checkbox" id="admAutoSchedule" class="w-5 h-5 rounded border-gray-600 text-cyan-600 focus:ring-cyan-500" onchange="toggleAutoUI(); saveSettings()">
                            <span class="font-bold text-cyan-400">üïí Hor√°rio Autom√°tico</span>
                        </label>
                    </div>
                    
                    <div id="scheduleInputs" class="transition-opacity duration-300">
                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div>
                                <label class="text-xs text-gray-400">Abre √†s:</label>
                                <input type="time" id="admScheduleOpen" class="input-dark text-center" onchange="saveSettings()">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">Fecha √†s:</label>
                                <input type="time" id="admScheduleClose" class="input-dark text-center" onchange="saveSettings()">
                            </div>
                        </div>
                        
                        <!-- Dias da Semana -->
                        <div>
                            <label class="text-xs text-gray-400 mb-1 block">Dias de Funcionamento:</label>
                            <div id="daysContainer" class="flex justify-between gap-1">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-4 mb-4 border-t border-gray-700 pt-4">
                    <div>
                        <label class="text-xs text-gray-400">Link da Logo (URL da Imagem)</label>
                        <input type="text" id="admLogo" placeholder="http://exemplo.com/logo.jpg" class="input-dark" onchange="saveSettings()">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">Link do Banner (URL da Imagem)</label>
                        <input type="text" id="admBanner" placeholder="http://exemplo.com/banner.jpg" class="input-dark" onchange="saveSettings()">
                    </div>
                </div>

                <!-- NOVA √ÅREA: CONFIGURA√á√ÉO IA -->
                <div class="grid grid-cols-1 gap-4 mb-4 border-t border-gray-700 pt-4">
                    <h4 class="text-sm font-bold text-cyan-400 mb-1">ü§ñ Configura√ß√µes IA</h4>
                    <div class="flex items-center gap-4">
                        <label class="flex items-center gap-2 cursor-pointer select-none">
                            <input type="checkbox" id="admAiEnabled" class="w-5 h-5 rounded border-gray-600 text-cyan-600 focus:ring-cyan-500" onchange="saveSettings()">
                            <span class="text-xs text-gray-300">Ativar Sugest√£o IA</span>
                        </label>
                        <div class="flex-1">
                            <label class="text-xs text-gray-400 block mb-1">Nome do Assistente IA</label>
                            <input type="text" id="admAiName" placeholder="Ex: Chef IA, Z√© da Marmita" class="input-dark" onchange="saveSettings()">
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-700 pt-4">
                    <div>
                        <label class="text-xs text-gray-400">Taxa de Entrega (R$)</label>
                        <input type="number" id="admDeliveryFee" class="input-dark" step="0.50" onchange="saveSettings()">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">WhatsApp (apenas n√∫meros, com 55)</label>
                        <input type="text" id="admPhone" class="input-dark" onchange="saveSettings()">
                    </div>
                </div>

                <!-- NOVA √ÅREA: SEGURAN√áA (SENHA) -->
                <div class="grid grid-cols-1 gap-4 mb-4 border-t border-gray-700 pt-4">
                    <h4 class="text-sm font-bold text-cyan-400 mb-1">üîê Seguran√ßa</h4>
                    <div>
                        <label class="text-xs text-gray-400">Senha do Dono</label>
                        <input type="text" id="admPassword" class="input-dark" onchange="saveSettings()">
                    </div>
                </div>
            </div>

            <!-- Bot√£o Adicionar Categoria -->
            <button onclick="addNewCategory()" class="w-full mb-6 py-4 border-2 border-dashed border-gray-600 text-gray-400 rounded-xl hover:border-cyan-500 hover:text-cyan-500 hover:bg-gray-800 transition-all font-bold flex items-center justify-center gap-2">
                <i class="fas fa-plus-circle text-xl"></i> CRIAR NOVA CATEGORIA
            </button>

            <!-- Editor de Itens -->
            <div class="space-y-6" id="adminItemsContainer">
                <!-- Os editores de categorias ser√£o gerados aqui -->
            </div>

            <!-- Bot√£o Salvar Firebase -->
            <div class="fixed bottom-0 left-0 right-0 bg-gray-800 p-4 border-t border-gray-700 text-center">
                <p class="text-xs text-green-400 mb-2 font-bold"><i class="fas fa-check-circle"></i> Sincroniza√ß√£o Autom√°tica Ativa</p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 z-[80] bg-cyan-500 text-black px-4 py-3 rounded-lg shadow-xl translate-x-full transition-transform duration-300 pointer-events-none">
        <span id="toastMsg" class="font-bold text-sm">A√ß√£o realizada!</span>
    </div>

    <!-- SCRIPT DO SISTEMA -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==========================================
        // 1. CONFIGURA√á√ÉO & DADOS (FIREBASE REALTIME)
        // ==========================================
        
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : null;

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'demo-app';
        const apiKey = ""; // API Key para Gemini

        let db = null;
        let auth = null;
        let unsubscribe = null;

        // Dados Padr√£o (Usado se n√£o tiver nada salvo)
        const defaultData = {
            settings: {
                isOpen: true,
                deliveryFee: 3.00,
                phone: "5587981612970",
                logoUrl: "", 
                bannerUrl: "",
                autoSchedule: false,
                scheduleOpen: "08:00",
                scheduleClose: "18:00",
                scheduleDays: [1, 2, 3, 4, 5, 6],
                aiChefName: "Chef IA", // Novo Padr√£o
                aiChefEnabled: true,    // Novo Padr√£o
                adminPassword: "admin" // Senha padr√£o
            },
            categories: [
                {
                    id: "marmitas",
                    name: "Marmitas Tradicionais",
                    icon: "fa-utensils",
                    items: [
                        { id: 1, name: "Monte sua Marmita", price: 15.00, desc: "Base: Arroz, feij√£o, macarr√£o e farofa.", type: "meat_selection" }
                    ]
                },
                {
                    id: "bebidas",
                    name: "Bebidas",
                    icon: "fa-glass-cheers",
                    items: [
                        { id: 6, name: "Coca-Cola Lata", price: 6.00 }
                    ]
                }
            ],
            meatOptions: [
                "Frango Assado", "Frango ao Molho", "F√≠gado Acebolado", 
                "Fil√© de Frango", "Bisteca de Porco", "Lingui√ßa"
            ]
        };

        // Estado Global
        window.appData = defaultData;
        window.cart = [];
        window.isDelivery = true;
        window.meatSelection = null;

        // ==========================================
        // 2. INICIALIZA√á√ÉO FIREBASE
        // ==========================================

        async function initFirebase() {
            if (!firebaseConfig) {
                console.log("Modo Demo (Sem Backend)");
                window.appData = JSON.parse(localStorage.getItem('marmitaData')) || defaultData;
                
                // Migra√ß√£o de dados locais
                if (typeof window.appData.settings.aiChefName === 'undefined') window.appData.settings.aiChefName = "Chef IA";
                if (typeof window.appData.settings.aiChefEnabled === 'undefined') window.appData.settings.aiChefEnabled = true;
                if (typeof window.appData.settings.adminPassword === 'undefined') window.appData.settings.adminPassword = "admin";
                
                renderApp();
                return;
            }

            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            // Autentica√ß√£o (Regra 3)
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (e) {
                console.error("Erro Auth:", e);
                return;
            }

            // Escutar Mudan√ßas no Banco (Regra 1 & 2)
            onAuthStateChanged(auth, (user) => {
                if (!user) return;
                
                const menuRef = doc(db, 'artifacts', appId, 'public', 'data', 'restaurant_config', 'menu');
                
                unsubscribe = onSnapshot(menuRef, (docSnap) => {
                    if (docSnap.exists()) {
                        window.appData = docSnap.data();
                        
                        // Migra√ß√£o de dados em tempo real se campos novos n√£o existirem
                        let needsUpdate = false;
                        if (typeof window.appData.settings.aiChefName === 'undefined') {
                            window.appData.settings.aiChefName = "Chef IA";
                            needsUpdate = true;
                        }
                        if (typeof window.appData.settings.aiChefEnabled === 'undefined') {
                            window.appData.settings.aiChefEnabled = true;
                            needsUpdate = true;
                        }
                        if (typeof window.appData.settings.adminPassword === 'undefined') {
                            window.appData.settings.adminPassword = "admin";
                            needsUpdate = true;
                        }
                        if (needsUpdate) {
                            setDoc(menuRef, window.appData); // Salva os padr√µes novos
                        }

                        console.log("Dados recebidos da nuvem!");
                    } else {
                        // Se n√£o existe, cria com padr√£o
                        console.log("Criando dados iniciais...");
                        setDoc(menuRef, defaultData);
                        window.appData = defaultData;
                    }
                    renderApp();
                }, (error) => {
                    console.error("Erro ao ler dados:", error);
                    showToast("Erro de conex√£o");
                });
            });
        }

        // ==========================================
        // 3. FUN√á√ïES GLOBAIS (Ligadas ao HTML)
        // ==========================================
        
        // --- GEMINI AI CHEF ---
        window.askChefAI = async function() {
            const aiModal = document.getElementById('aiModal');
            const aiContent = document.getElementById('aiContent');
            const chefName = window.appData.settings.aiChefName || "Chef IA";
            
            // Atualiza T√≠tulo do Modal
            document.getElementById('aiModalTitle').innerText = `${chefName} Sugere`;

            aiModal.classList.remove('hidden');
            aiContent.innerHTML = `
                <i class="fas fa-circle-notch fa-spin text-cyan-400 text-3xl mb-4"></i>
                <p class="text-gray-400 text-sm animate-pulse">${chefName} est√° a analisar o menu...</p>
            `;
            
            // Build menu string
            let menuContext = "";
            window.appData.categories.forEach(cat => {
                const today = new Date().getDay();
                // Verifica se a categoria est√° vis√≠vel hoje antes de enviar pra IA
                const isVisibleToday = !cat.allowedDays || cat.allowedDays.length === 0 || cat.allowedDays.includes(today);
                
                if(isVisibleToday && cat.items && cat.items.length > 0) {
                    menuContext += `Categoria ${cat.name}: `;
                    cat.items.forEach(item => {
                        menuContext += `${item.name} (R$${item.price}), `;
                    });
                    menuContext += ". ";
                }
            });
            
            const prompt = `Voc√™ √© um assistente divertido chamado '${chefName}' do 'Disk Marmitas'. Baseado neste card√°pio de HOJE: [${menuContext}], sugira UMA op√ß√£o deliciosa para o cliente hoje. Descreva-a de forma irresist√≠vel em 1 ou 2 frases curtas. Use emojis. Fale em Portugu√™s do Brasil.`;
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                
                if (!response.ok) throw new Error('Falha na IA');
                
                const data = await response.json();
                const suggestion = data.candidates?.[0]?.content?.parts?.[0]?.text || "Hoje recomendo a nossa Marmita Tradicional!";
                
                aiContent.innerHTML = `
                    <p class="text-lg text-white font-medium italic leading-relaxed">"${suggestion}"</p>
                    <div class="mt-4 flex gap-2 justify-center">
                        <span class="text-2xl animate-bounce">üòã</span>
                        <span class="text-2xl animate-bounce" style="animation-delay: 0.1s">üç≤</span>
                    </div>
                `;
            } catch (error) {
                console.error(error);
                aiContent.innerHTML = `
                    <p class="text-red-400 mb-2">${chefName} est√° um pouco ocupado.</p>
                    <p class="text-white">Que tal experimentar a nossa <strong>Marmita Tradicional</strong>?</p>
                `;
            }
        };

        window.saveSettings = async function() {
            // Atualiza Objeto Global com valores dos inputs
            const s = window.appData.settings;
            
            s.isOpen = document.getElementById('admIsOpen').value === 'true';
            s.deliveryFee = parseFloat(document.getElementById('admDeliveryFee').value) || 0;
            s.phone = document.getElementById('admPhone').value;
            s.logoUrl = document.getElementById('admLogo').value;
            s.bannerUrl = document.getElementById('admBanner').value;
            s.autoSchedule = document.getElementById('admAutoSchedule').checked;
            s.scheduleOpen = document.getElementById('admScheduleOpen').value;
            s.scheduleClose = document.getElementById('admScheduleClose').value;
            
            // Novos Campos IA
            s.aiChefName = document.getElementById('admAiName').value || "Chef IA";
            s.aiChefEnabled = document.getElementById('admAiEnabled').checked;

            // Nova Senha
            s.adminPassword = document.getElementById('admPassword').value;

            // Salvar Dias da Semana da Loja Global
            const daysCheckboxes = document.querySelectorAll('.sched-day-cb:checked');
            s.scheduleDays = Array.from(daysCheckboxes).map(cb => parseInt(cb.value));

            // Checa Auto Schedule
            if (s.autoSchedule) checkAutoSchedule();

            // Salvar no Firebase
            if (db && auth.currentUser) {
                const menuRef = doc(db, 'artifacts', appId, 'public', 'data', 'restaurant_config', 'menu');
                try {
                    await setDoc(menuRef, window.appData);
                    // showToast("Salvo na nuvem!"); // Comentado para n√£o spamar
                } catch (e) {
                    console.error("Erro ao salvar:", e);
                    showToast("Erro ao salvar");
                }
            } else {
                localStorage.setItem('marmitaData', JSON.stringify(window.appData));
                renderApp(); // Atualiza localmente
            }
        };

        // --- EXPORTAR FUN√á√ïES DE UI PARA O ESCOPO GLOBAL ---
        
        window.openAdminLogin = () => {
            document.getElementById('adminLoginModal').classList.remove('hidden'); 
            document.getElementById('adminPass').focus();
        };
        
        window.closeAdminPanel = () => document.getElementById('adminPanel').classList.add('hidden');
        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
        window.openCartModal = () => document.getElementById('cartModal').classList.remove('hidden');

        window.checkAdminLogin = () => {
            const pass = document.getElementById('adminPass').value;
            const currentPass = window.appData.settings.adminPassword || "admin";
            
            if (pass === currentPass) { 
                window.closeModal('adminLoginModal');
                document.getElementById('adminPanel').classList.remove('hidden');
                renderAdminPanel();
                document.getElementById('adminPass').value = ''; 
            } else {
                showToast("‚ùå Senha incorreta!");
            }
        };

        window.toggleAutoUI = () => {
            const isAuto = document.getElementById('admAutoSchedule').checked;
            const scheduleInputs = document.getElementById('scheduleInputs');
            const manualSelect = document.getElementById('admIsOpen');
            const manualHint = document.getElementById('manualStatusHint');

            if (isAuto) {
                scheduleInputs.classList.remove('opacity-50', 'pointer-events-none');
                manualSelect.disabled = true;
                manualHint.classList.remove('hidden');
            } else {
                scheduleInputs.classList.add('opacity-50', 'pointer-events-none');
                manualSelect.disabled = false;
                manualHint.classList.add('hidden');
            }
        };

        // --- CARRINHO & PEDIDOS ---

        window.selectMeat = (btn, meat) => {
            document.querySelectorAll('.meat-option').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            window.meatSelection = meat;
        };

        window.addMeatItem = (baseName, price) => {
            if (!window.meatSelection) {
                showToast("‚ö†Ô∏è Escolha uma carne primeiro!");
                return;
            }
            window.addToCart(`${baseName} (${window.meatSelection})`, price);
            window.meatSelection = null;
            document.querySelectorAll('.meat-option').forEach(b => b.classList.remove('selected'));
        };

        window.addToCart = (name, price) => {
            if (!window.appData.settings.isOpen) {
                showToast("üî¥ Loja Fechada no momento.");
                return;
            }
            window.cart.push({ name, price });
            updateCartUI();
            showToast("Item adicionado!");
        };

        window.removeFromCart = (index) => {
            window.cart.splice(index, 1);
            updateCartUI();
        };

        window.toggleDelivery = (status) => {
            window.isDelivery = status;
            const addressInput = document.getElementById('clientAddress');
            const opt1 = document.getElementById('delOption1');
            const opt2 = document.getElementById('delOption2');

            if (window.isDelivery) {
                addressInput.classList.remove('hidden');
                opt1.classList.add('border-cyan-500'); opt1.classList.remove('border-gray-600');
                opt2.classList.remove('border-cyan-500'); opt2.classList.add('border-gray-600');
            } else {
                addressInput.classList.add('hidden');
                opt1.classList.remove('border-cyan-500'); opt1.classList.add('border-gray-600');
                opt2.classList.add('border-cyan-500'); opt2.classList.remove('border-gray-600');
            }
            updateCartUI();
        };

        window.finalizeOrder = () => {
            if (window.cart.length === 0) return;

            const name = document.getElementById('clientName').value.trim();
            const address = document.getElementById('clientAddress').value.trim();
            const payment = document.getElementById('paymentMethod').value;
            const obs = document.getElementById('orderObs').value.trim();

            if (!name || !payment || (window.isDelivery && !address)) {
                showToast("‚ö†Ô∏è Preencha os dados obrigat√≥rios!");
                return;
            }

            let orderCount = localStorage.getItem('orderCount') || 1000;
            orderCount++;
            localStorage.setItem('orderCount', orderCount);

            const summary = {};
            let subtotal = 0;
            window.cart.forEach(i => {
                summary[i.name] = (summary[i.name] || 0) + 1;
                subtotal += i.price;
            });

            let msg = `*PEDIDO #${orderCount}*\n`;
            msg += `Tipo: ${window.isDelivery ? 'ENTREGA üõµ' : 'RETIRADA üèÉ'}\n\n`;
            
            for (let [item, qtd] of Object.entries(summary)) {
                msg += `${qtd}x ${item}\n`;
            }

            const fee = window.isDelivery ? window.appData.settings.deliveryFee : 0;
            msg += `\nSubtotal: R$ ${subtotal.toFixed(2)}`;
            msg += `\nTaxa: R$ ${fee.toFixed(2)}`;
            msg += `\n*TOTAL: R$ ${(subtotal + fee).toFixed(2)}*\n`;
            msg += `\nNome: ${name}`;
            if (window.isDelivery) msg += `\nEndere√ßo: ${address}`;
            msg += `\nPagto: ${payment}`;
            if (obs) msg += `\nObs: ${obs}`;

            window.open(`https://wa.me/${window.appData.settings.phone}?text=${encodeURIComponent(msg)}`, '_blank');
        };

        // --- CRUD ITENS ---
        window.addNewCategory = () => {
            const newCat = {
                id: "cat_" + Date.now(),
                name: "Nova Categoria",
                icon: "fa-circle", 
                items: [
                    { id: Date.now(), name: "Novo Item", price: 10.00 } 
                ],
                allowedDays: [0, 1, 2, 3, 4, 5, 6] // Padr√£o: Todos os dias
            };
            window.appData.categories.push(newCat);
            window.saveSettings();
            renderAdminPanel();
            setTimeout(() => {
                const container = document.getElementById('adminItemsContainer');
                container.lastElementChild.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        };

        window.updateCategory = (catIdx, field, value) => {
            window.appData.categories[catIdx][field] = value;
            window.saveSettings();
        };
        
        window.toggleCategoryDay = (catIdx, day) => {
            const cat = window.appData.categories[catIdx];
            if (!cat.allowedDays) cat.allowedDays = [0, 1, 2, 3, 4, 5, 6];
            
            if (cat.allowedDays.includes(day)) {
                cat.allowedDays = cat.allowedDays.filter(d => d !== day);
            } else {
                cat.allowedDays.push(day);
            }
            window.saveSettings();
            renderAdminPanel(); // Re-render to show checkbox change visually if needed
        };

        window.deleteCategory = (catIdx) => {
            if(confirm("Tem certeza que deseja apagar esta categoria inteira?")) {
                window.appData.categories.splice(catIdx, 1);
                window.saveSettings();
                renderAdminPanel();
            }
        };

        window.addItemToCategory = (catIdx) => {
            window.appData.categories[catIdx].items.push({
                id: Date.now(),
                name: "Novo Item",
                price: 0
            });
            window.saveSettings();
            renderAdminPanel();
        };

        window.updateItem = (catIdx, itemIdx, field, value) => {
            if (field === 'price') value = parseFloat(value) || 0;
            window.appData.categories[catIdx].items[itemIdx][field] = value;
            window.saveSettings();
        };

        window.deleteItem = (catIdx, itemIdx) => {
            if(confirm("Apagar este item?")) {
                window.appData.categories[catIdx].items.splice(itemIdx, 1);
                window.saveSettings();
                renderAdminPanel();
            }
        };


        // ==========================================
        // 4. HELPERS
        // ==========================================

        function checkAutoSchedule() {
            if (!window.appData.settings.autoSchedule) return;

            const now = new Date();
            const currentDay = now.getDay(); 
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const allowedDays = window.appData.settings.scheduleDays || [0,1,2,3,4,5,6];

            if (!allowedDays.includes(currentDay)) {
                if (window.appData.settings.isOpen !== false) {
                    window.appData.settings.isOpen = false;
                    window.saveSettings(); // Atualiza na nuvem
                }
                return;
            }

            const [openH, openM] = (window.appData.settings.scheduleOpen || "08:00").split(':').map(Number);
            const [closeH, closeM] = (window.appData.settings.scheduleClose || "18:00").split(':').map(Number);
            const startMinutes = openH * 60 + openM;
            const endMinutes = closeH * 60 + closeM;

            let isOpenNow = false;
            if (endMinutes > startMinutes) {
                isOpenNow = currentMinutes >= startMinutes && currentMinutes < endMinutes;
            } else {
                isOpenNow = currentMinutes >= startMinutes || currentMinutes < endMinutes;
            }

            if (window.appData.settings.isOpen !== isOpenNow) {
                window.appData.settings.isOpen = isOpenNow;
                window.saveSettings(); // Persiste a mudan√ßa autom√°tica
                console.log("Auto Schedule: Status changed to", isOpenNow);
            }
        }

        function renderApp() {
            checkAutoSchedule();
            updateHeader();
            renderMenu();
        }

        function updateHeader() {
            document.getElementById('headerDeliveryFee').innerText = `R$ ${window.appData.settings.deliveryFee.toFixed(2)}`;
            const badge = document.getElementById('statusBadge');
            
            const logoImg = document.getElementById('headerLogo');
            if (window.appData.settings.logoUrl && window.appData.settings.logoUrl.trim() !== "") {
                logoImg.src = window.appData.settings.logoUrl;
                logoImg.classList.remove('hidden');
            } else {
                logoImg.classList.add('hidden');
            }

            if (window.appData.settings.isOpen) {
                badge.innerText = "ABERTO";
                badge.className = "inline-block px-2 py-1 rounded bg-green-500/20 text-green-400 text-[10px] font-bold border border-green-500/30 mb-1";
            } else {
                badge.innerText = "FECHADO";
                badge.className = "inline-block px-2 py-1 rounded bg-red-500/20 text-red-400 text-[10px] font-bold border border-red-500/30 mb-1";
            }
        }

        function renderMenu() {
            const container = document.getElementById('menuContainer');
            container.innerHTML = ''; 
            
            // --- BOT√ÉO DO CHEF IA (NOVO - CONDICIONAL) ---
            // S√≥ exibe se a op√ß√£o estiver ativada nas configura√ß√µes
            if (window.appData.settings.aiChefEnabled) {
                const chefName = window.appData.settings.aiChefName || "Chef IA";
                container.innerHTML += `
                    <div class="text-center mb-6">
                         <button onclick="askChefAI()" class="bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-cyan-500/30 transform transition-all hover:scale-105 animate-sparkle flex items-center gap-2 mx-auto">
                            <i class="fas fa-magic"></i> N√£o sabe o que pedir? Pergunte ao ${chefName} ‚ú®
                        </button>
                    </div>
                `;
            }

            if (window.appData.settings.bannerUrl && window.appData.settings.bannerUrl.trim() !== "") {
                container.innerHTML += `
                    <div class="w-full h-40 sm:h-56 md:h-72 rounded-2xl overflow-hidden mb-8 relative shadow-xl group border border-gray-700">
                        <img src="${window.appData.settings.bannerUrl}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="Banner Promocional">
                        <div class="absolute inset-0 bg-gradient-to-t from-gray-900/80 to-transparent"></div>
                        <div class="absolute bottom-4 left-4">
                             <h2 class="text-2xl font-bold text-white drop-shadow-md">Bem-vindo!</h2>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML += `
                    <div class="glass-panel p-6 rounded-2xl text-center space-y-4 relative overflow-hidden mb-8">
                        <div class="absolute top-0 right-0 w-24 h-24 bg-cyan-400 opacity-10 rounded-bl-full"></div>
                        <h2 class="text-xl md:text-2xl font-bold">Bateu a fome? üòã</h2>
                        <p class="text-gray-300 text-sm">Fa√ßa seu pedido online. Simples e r√°pido!</p>
                    </div>
                `;
            }
            
            const today = new Date().getDay(); // 0=Dom ... 6=Sab

            window.appData.categories.forEach(cat => {
                if(cat.items.length === 0) return;
                
                // CHECK if category is allowed today
                if(cat.allowedDays && cat.allowedDays.length > 0 && !cat.allowedDays.includes(today)) {
                    return; // SKIP this category today
                }

                let html = `
                    <section>
                        <h3 class="text-2xl font-bold mb-6 flex items-center gap-2 text-white">
                            <i class="fas ${cat.icon} text-cyan-400"></i> ${cat.name}
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                `;

                cat.items.forEach(item => {
                    const isSatOnly = item.onlySaturday;
                    const isLocked = isSatOnly && today !== 6;

                    if (item.type === 'meat_selection') {
                        html += renderMeatCard(item);
                    } else {
                        html += `
                            <div class="glass-panel p-4 rounded-xl flex flex-col justify-between h-full border border-gray-700 hover:border-cyan-400 transition-colors ${isLocked ? 'opacity-50 grayscale' : ''}">
                                <div>
                                    <div class="flex justify-between items-start">
                                        <h4 class="font-bold text-lg ${isLocked ? 'text-gray-400' : ''}">${item.name}</h4>
                                        <span class="text-cyan-400 font-bold">R$ ${item.price.toFixed(2)}</span>
                                    </div>
                                    ${item.desc ? `<p class="text-gray-400 text-xs mt-1 mb-3">${item.desc}</p>` : ''}
                                </div>
                                <button onclick="addToCart('${item.name}', ${item.price})" ${isLocked || !window.appData.settings.isOpen ? 'disabled' : ''} 
                                    class="w-full ${isLocked ? 'bg-gray-800 cursor-not-allowed' : 'bg-gray-700 hover:bg-gray-600'} text-white text-sm py-2 rounded-lg flex items-center justify-center gap-2 transition-colors">
                                    ${isLocked ? '<i class="fas fa-lock"></i> Apenas S√°bado' : '<i class="fas fa-plus text-xs"></i> Adicionar'}
                                </button>
                            </div>
                        `;
                    }
                });

                html += `</div></section>`;
                container.innerHTML += html;
            });
        }

        function renderMeatCard(item) {
            let meatsHtml = '';
            window.appData.meatOptions.forEach(meat => {
                meatsHtml += `
                    <button onclick="selectMeat(this, '${meat}')" class="meat-option p-2 rounded bg-gray-800 text-xs text-left hover:bg-gray-700 transition-colors">
                        ${meat}
                    </button>
                `;
            });

            return `
                <div class="glass-panel rounded-2xl overflow-hidden card-shadow border-l-4 border-cyan-400 col-span-1 md:col-span-2 lg:col-span-3">
                    <div class="p-5">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-xl font-bold text-white">${item.name}</h4>
                            <span class="price-tag px-4 py-1 rounded-sm text-lg">R$ ${item.price.toFixed(2)}</span>
                        </div>
                        <p class="text-gray-400 text-sm mb-4 pb-2 border-b border-gray-700">${item.desc}</p>
                        
                        <p class="text-cyan-400 font-bold text-xs uppercase mb-2">1. Escolha a Carne:</p>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mb-4">
                            ${meatsHtml}
                        </div>

                        <button onclick="addMeatItem('${item.name}', ${item.price})" ${!window.appData.settings.isOpen ? 'disabled' : ''}
                            class="w-full bg-cyan-500 hover:bg-cyan-400 text-black font-bold py-3 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-cyan-500/20 transition-all">
                            <i class="fas fa-plus"></i> Adicionar Marmita
                        </button>
                    </div>
                </div>
            `;
        }

        function updateCartUI() {
            const total = window.cart.reduce((acc, item) => acc + item.price, 0);
            
            document.getElementById('cartTotal').innerText = `R$ ${total.toFixed(2)}`;
            document.getElementById('cartCount').innerText = `(${window.cart.length})`;
            const bar = document.getElementById('cartBar');
            
            if (window.cart.length > 0) bar.classList.remove('translate-y-full');
            else bar.classList.add('translate-y-full');

            const list = document.getElementById('cartItemsList');
            list.innerHTML = '';
            window.cart.forEach((item, index) => {
                list.innerHTML += `
                    <div class="flex justify-between items-center bg-gray-800 p-2 rounded border border-gray-700">
                        <span class="text-sm font-medium text-gray-200">${item.name}</span>
                        <div class="flex items-center gap-3">
                            <span class="text-cyan-400 text-xs font-bold">R$ ${item.price.toFixed(2)}</span>
                            <button onclick="removeFromCart(${index})" class="text-red-400 hover:text-red-300"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });

            const fee = window.isDelivery ? window.appData.settings.deliveryFee : 0;
            document.getElementById('checkoutFee').innerText = window.isDelivery ? `R$ ${fee.toFixed(2)}` : 'Gr√°tis';
            document.getElementById('checkoutTotal').innerText = `R$ ${(total + fee).toFixed(2)}`;
        }

        function renderAdminPanel() {
            document.getElementById('admIsOpen').value = window.appData.settings.isOpen.toString();
            document.getElementById('admDeliveryFee').value = window.appData.settings.deliveryFee;
            document.getElementById('admPhone').value = window.appData.settings.phone;
            document.getElementById('admLogo').value = window.appData.settings.logoUrl || "";
            document.getElementById('admBanner').value = window.appData.settings.bannerUrl || "";
            
            document.getElementById('admAutoSchedule').checked = window.appData.settings.autoSchedule || false;
            document.getElementById('admScheduleOpen').value = window.appData.settings.scheduleOpen || "08:00";
            document.getElementById('admScheduleClose').value = window.appData.settings.scheduleClose || "18:00";
            
            // Novos Inputs IA
            document.getElementById('admAiName').value = window.appData.settings.aiChefName || "Chef IA";
            document.getElementById('admAiEnabled').checked = window.appData.settings.aiChefEnabled;

            // Input Senha
            document.getElementById('admPassword').value = window.appData.settings.adminPassword || "admin";

            const daysContainer = document.getElementById('daysContainer');
            const daysOfWeek = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "S√°b"];
            const savedDays = window.appData.settings.scheduleDays || [1,2,3,4,5,6];
            
            let daysHtml = '';
            daysOfWeek.forEach((day, idx) => {
                const isChecked = savedDays.includes(idx) ? 'checked' : '';
                daysHtml += `
                    <label class="flex flex-col items-center cursor-pointer">
                        <input type="checkbox" class="peer hidden sched-day-cb" value="${idx}" ${isChecked} onchange="saveSettings()">
                        <span class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 border border-gray-600 text-[10px] text-gray-400 peer-checked:bg-cyan-600 peer-checked:text-white peer-checked:border-cyan-500 transition-all font-bold select-none hover:bg-gray-700">
                            ${day}
                        </span>
                    </label>
                `;
            });
            daysContainer.innerHTML = daysHtml;

            window.toggleAutoUI(); 

            const container = document.getElementById('adminItemsContainer');
            container.innerHTML = '';

            window.appData.categories.forEach((cat, catIdx) => {
                // RENDERIZAR OS DIAS ESPEC√çFICOS DA CATEGORIA
                const catDays = cat.allowedDays || [0, 1, 2, 3, 4, 5, 6];
                let catDaysHtml = '';
                const catDaysShort = ["D", "S", "T", "Q", "Q", "S", "S"];
                
                catDaysShort.forEach((day, idx) => {
                    const isChecked = catDays.includes(idx) ? 'bg-cyan-600 text-white border-cyan-500' : 'bg-gray-800 text-gray-500 border-gray-600';
                    catDaysHtml += `
                        <button onclick="toggleCategoryDay(${catIdx}, ${idx})" class="w-6 h-6 rounded text-[10px] font-bold border ${isChecked} transition-colors hover:opacity-80">
                            ${day}
                        </button>
                    `;
                });

                let html = `
                    <div class="glass-panel p-4 rounded-xl border border-gray-600 relative group">
                        <button onclick="deleteCategory(${catIdx})" class="absolute top-2 right-2 text-gray-500 hover:text-red-500 bg-gray-900 rounded-full w-8 h-8 flex items-center justify-center transition-colors">
                            <i class="fas fa-trash-alt text-xs"></i>
                        </button>

                        <label class="text-xs text-gray-500 uppercase tracking-wide mb-1 block">Nome da Categoria</label>
                        <input type="text" value="${cat.name}" class="input-dark font-bold text-cyan-400 mb-2 border-none text-lg p-0 bg-transparent focus:ring-0" onchange="updateCategory(${catIdx}, 'name', this.value)">

                        <!-- SELETOR DE DIAS DA CATEGORIA -->
                        <div class="mb-4 bg-gray-900/50 p-2 rounded-lg inline-block">
                            <p class="text-[9px] text-gray-400 uppercase tracking-widest mb-1">Dispon√≠vel em:</p>
                            <div class="flex gap-1">
                                ${catDaysHtml}
                            </div>
                        </div>

                        <div class="space-y-3">
                `;
                
                cat.items.forEach((item, itemIdx) => {
                    html += `
                        <div class="flex gap-2 items-center bg-gray-800 p-2 rounded border border-gray-700/50">
                            <input type="text" value="${item.name}" class="input-dark text-xs flex-1 bg-transparent border-none focus:bg-gray-700" placeholder="Nome do item" onchange="updateItem(${catIdx}, ${itemIdx}, 'name', this.value)">
                            <div class="flex items-center gap-1 bg-gray-900 rounded px-2">
                                <span class="text-xs text-gray-500">R$</span>
                                <input type="number" value="${item.price}" class="input-dark text-xs w-16 bg-transparent border-none focus:bg-gray-700 text-right" step="0.5" onchange="updateItem(${catIdx}, ${itemIdx}, 'price', this.value)">
                            </div>
                            <button onclick="deleteItem(${catIdx}, ${itemIdx})" class="text-gray-500 hover:text-red-400 px-2"><i class="fas fa-times"></i></button>
                        </div>
                    `;
                });

                html += `
                        </div>
                        <button onclick="addItemToCategory(${catIdx})" class="mt-4 w-full py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-xs text-gray-300 border border-gray-700 border-dashed transition-colors">
                            + Adicionar Item
                        </button>
                    </div>`;
                container.innerHTML += html;
            });
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.classList.remove('translate-x-full');
            if (window.toastTimeout) clearTimeout(window.toastTimeout);
            window.toastTimeout = setTimeout(() => t.classList.add('translate-x-full'), 3000);
        }

        // Start
        initFirebase();

    </script>
</body>
</html>
